### テスト実験を行う

本ステップでは、本サービスにおける実験実行環境利用の「HelloWorld」としてテスト実験環境を構築し、NumPy を利用する簡単な計算を行います。本ステップで実践する手順を以下に示します。

1. 実験実行環境を構築する
2. 実験の初期セットアップを行う
3. ノートブックを作成して計算を実行する
4. 実験結果を研究用リポジトリに同期する
5. 実験を終了し、実験実行環境を削除する
6. 実験を再開する

#### 実験実行環境を構築する

研究フロートップページの研究フロー図中にある「実験を行う」をクリックします。それにより実験実行環境構築用ノートブック（下図）に遷移します。

![]()

遷移先のノートブックにて上から順にセルを実行します。最後のセルの実行結果に現れる「」をクリックします。それにより、コード付帯機能を利用する実験実行環境の構築が開始されます（下図）。

![]()

環境構築後、自動的に実験フロートップページ（下図）に遷移します。このページでは実験実行環境における共通フローの他、実験フロー図を表示できます。実験中は主に実験フロー図（下図）を利用します。

![]()

#### 実験の初期セットアップを行う

実験フロートップページにて上から順にセルを実行します。そうして現れた実験フロー図にある「実験の初期セットアップを行う」をクリックし、初期セットアップ用ノートブック（下図）に遷移します。

![]()

そのノートブックにて上から順にセルを実行します。途中でアカウント情報および実験名の入力が求められます。アカウント情報にはご自身のアカウント情報を、実験名には以下を入力してください。

```
hello_world
```

全てのセルを実行し終えたら、実験フロートップページに遷移します。実験フロートップページにて実験フロー図を更新すると、実験フロー図中の「初期セットアップを行う」に「済」の印が付きます。

#### ノートブックを作成して計算を実行する

実験フロートップページのメニュータブのうち「」をクリックし、プルダウンメニューを表示します。プルダウンメニュー中の「Open」をクリックし、別タブで開かれる Jupyter Notebook ページ（下図）に遷移します。

![]()

このページにて、「root（フォルダマーク）」→「experiments」→「hello_world」→「source」の順にクリックして実験用ディレクトリに遷移します（下図参照）。

![]()

source ディレクトリにて `hello_world.ipynb` を作成します。作成後、そのノートブックをクリックして表示します。

このノートブックは通常の Jupyter Notebook のそれと同じように操作することが可能です。最初のセルで NumPy モジュールをインポートして正弦関数を計算してみましょう：

```python
import numpy as np

x = np.linspace(0., np.pi, 100)
y = np.sin(x)
```

別のセルを作成します。そのセル内で matplotlib を利用して先ほど計算した正弦関数をプロットします：

```python
import matplotlib.pyplot as plt
% matplotlib inline

plt.figure(figsize=(6,5))
plt.plot(x, y)
plt.title("hello world!")
plt.xlabel("x")
plt.ylabel("y = sin(x)")
```

もう一つ別のセルを作成します。そのセルの中で計算結果（`x` と `y`）を `output_data` ディレクトリ内に NumPy 形式で保存します：

```python
np.save(x, "../output_data/hello_world_x.npy")
np.save(y, "../output_data/hello_world_y.npy")
```

#### 実験結果を研究用リポジトリに同期する

実験結果を研究用リポジトリに同期する場合、次の二つの方法があります。

* 実験を途中保存する。
* 実験終了時に保存する。

今回は頻繁に発生すると考えられる途中保存を実行します。実験フロー図中の「実験結果を途中保存する」をクリックし、途中保存用ノートブック（下図）に遷移します。

![]()

遷移先のノートブックで上から順にセルを実行します。途中でコミットメッセージの入力が求められます。今回は「hello world」と入力します。全てのセルの実行が正常に完了したら同期成功です。

#### 実験を終了し、実験実行環境を削除する

実験を終了するとき、再現性の確保や再実験を行う場合に備えて、その実験が行われた環境構成を保存しておくことが望ましいです。本サービスではそれらの操作がボタンクリックのみで完結します。

実験フロー図中の「実験を終了する」をクリックし、実験終了用ノートブック（下図）に遷移します。

![]()

このノートブック内でセルを上から順に実行します。最後のセルの実行後に、現在実験を行っている環境のタグが表示されます。JupyterHub のサーバー管理ページ（下図）に遷移し、そのタグに対応する環境を stop & delete します。これにて実験実行環境を削除できます。

#### 実験を再開する

実験を再開する場合は、研究用リポジトリの「container list」から研究実行環境グループの「
rebuild」を

#### まとめ

本ステップではリサーチフローを利用して、実験実行環境の構築、実験実施、実験の終了までの手順を試しました。

本ステップを完了したら[次のステップに進みましょう](./carry_out_main_experiment.md)。
